{"ast":null,"code":"var _jsxFileName = \"/home/fer/UCE/Tesis/blockchain-dapp/client/src/components/SubmitForm.js\";\nimport React, { Component } from 'react';\nimport { Form, FormControl, Button, Alert, Row, Col } from 'react-bootstrap';\n\nvar Loader = require('react-loader');\n\nclass SubmitForm extends Component {\n  constructor(props) {\n    super(props);\n\n    this.captureFile = event => {\n      event.stopPropagation();\n      event.preventDefault();\n      const file = event.target.files[0];\n      let reader = new window.FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onloadend = () => this.convertToBuffer(reader);\n    };\n\n    this.convertToBuffer = async reader => {\n      //file is converted to a buffer for upload to IPFS\n      const buffer = await Buffer.from(reader.result); //set this buffer-using es6 syntax\n\n      this.setState({\n        buffer\n      });\n    };\n\n    this.state = {\n      loadingVersion: false,\n      loadingPrice: false,\n      fullName: '',\n      title: '',\n      text: '',\n      price: ''\n    };\n  }\n\n  componentDidMount() {\n    if (this.props.match.params.id) {\n      this.loadSubmission(this.props.match.params.id);\n    }\n  }\n\n  UNSAFE_componentWillMount() {\n    this.loadPrice();\n  }\n\n  loadSubmission(hashId) {\n    return new Promise((resolve, reject) => {\n      this.setState({\n        loadingVersion: true\n      });\n      let submission = {};\n      this.props.hashStoreContractInstance.getPaperByID(hashId).then(values => {\n        submission.sender = values[0];\n        submission.hashContent = values[1];\n        submission.timestamp = values[2].toNumber();\n        submission.hashId = hashId;\n\n        if (submission.timestamp === 0) {\n          this.setState({\n            loadingVersion: false\n          });\n          this.props.addNotification(\"Cannot find the paper\", \"error\");\n          return reject(\"No paper found\");\n        }\n\n        this.setState({\n          submission: submission\n        });\n        this.setState({\n          loadingVersion: false\n        });\n        resolve(submission);\n      }).catch(err => {\n        this.setState({\n          loadingVersion: false\n        });\n        return reject(err);\n      });\n    });\n  }\n\n  loadPrice() {\n    console.log(this.props);\n    this.props.hashStoreContractInstance.price().then(result => {\n      this.setState({\n        price: result.toString()\n      });\n    });\n  } //Take file input from user\n\n\n  saveText() {\n    let {\n      fullName,\n      title,\n      text\n    } = this.state;\n    let data = {\n      fullName,\n      title,\n      text\n    };\n    let {\n      buffer\n    } = this.state;\n    this.setState({\n      savingText: true\n    });\n    this.props.ipfs.add(buffer, (err, fileHash) => {\n      if (err) {\n        this.setState({\n          savingText: false\n        });\n        return this.props.addNotification(err.message, \"error\");\n      }\n\n      data.file = fileHash;\n      console.log(\"IPFS file hash:\", fileHash);\n      this.props.ipfs.addJSON(data, (err, hash) => {\n        if (err) {\n          this.setState({\n            savingText: false\n          });\n          return this.props.addNotification(err.message, \"error\");\n        }\n\n        console.log(\"Saved to IPFS\", data);\n        console.log(\"IPFS hash:\", hash);\n        console.log(\"eth address:\", this.props.web3.eth.defaultAccount);\n        console.log(\"eth address:\", this.props.hashStoreContractInstance);\n\n        if (this.props.match.params.id) {\n          this.props.hashStoreContractInstance.saveNewVersion(hash, this.props.match.params.id, {\n            from: this.props.web3.eth.defaultAccount,\n            value: this.state.price,\n            gas: 200000\n          }).then(result => {\n            /* if(result.receipt.status !== \"0x1\"){ // can be used after byzantium to check status\n              throw new Error(\"Transaction failed\");\n            } */\n            this.setState({\n              savingText: false\n            });\n            console.log('Data saved successfully, Tx:', result.tx);\n            let log = result.logs[0];\n\n            let hashId = log.args._hashId.toNumber();\n\n            this.props.addNotification(`New version saved successfully ! Submission ID: ${hashId}`, \"success\"); //this.props.onSubmit(hashId);\n          }).catch(err => {\n            this.setState({\n              savingText: false\n            });\n            this.props.addNotification(err.message, \"error\");\n          });\n        } else {\n          this.props.hashStoreContractInstance.saveNewPaper(hash, {\n            from: this.props.web3.eth.defaultAccount,\n            value: this.state.price,\n            gas: 200000\n          }).then(result => {\n            /* if(result.receipt.status !== \"0x1\"){ // can be used after byzantium to check status\n              throw new Error(\"Transaction failed\");\n            } */\n            this.setState({\n              savingText: false\n            });\n            console.log('Data saved successfully, Tx:', result.tx);\n            let log = result.logs[0];\n\n            let hashId = log.args._hashId.toNumber();\n\n            this.props.addNotification(`Data saved successfully ! Submission ID: ${hashId}`, \"success\"); //this.props.onSubmit(hashId);\n          }).catch(err => {\n            this.setState({\n              savingText: false\n            });\n            this.props.addNotification(err.message, \"error\");\n          });\n        }\n      });\n    });\n  }\n\n  updateInputValue(e, field) {\n    this.setState({\n      [field]: e.target.value\n    });\n  }\n\n  validForm() {\n    if (!this.props.hashStoreContractInstance) {\n      return false;\n    }\n\n    return this.state.fullName && this.state.title && this.state.text && this.state.buffer;\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"SubmitForm\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 7\n      }\n    }, this.props.match.params.id ? /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }\n    }, \" Adding new version to \", this.props.match.params.id, \" \") : /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 15\n      }\n    }, \" Publish a pre-print on Dejournal \"), /*#__PURE__*/React.createElement(Loader, {\n      loaded: !this.state.loadingVersion,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 9\n      }\n    }, this.props.match.params.id && !this.state.submission ? /*#__PURE__*/React.createElement(Alert, {\n      variant: \"danger\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 13\n      }\n    }, \"ERROR: Paper with ID \", this.props.match.params.id, \" was not found.\") : /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      xs: 10,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Form, {\n      className: \"mt-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Form.Group, {\n      controlId: \"formGroupTitle\",\n      className: \"mt-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 181,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(FormControl, {\n      required: true,\n      type: \"text\",\n      onChange: e => this.updateInputValue(e, 'title'),\n      placeholder: \"Title\",\n      value: this.state.title,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(Form.Group, {\n      controlId: \"formGroupAuthors\",\n      className: \"mt-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(FormControl, {\n      required: true,\n      type: \"text\",\n      onChange: e => this.updateInputValue(e, 'fullName'),\n      placeholder: \"Authors\",\n      value: this.state.fullName,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(Form.Group, {\n      controlId: \"formGroupAbstract\",\n      className: \"mt-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(FormControl, {\n      required: true,\n      as: \"textarea\",\n      onChange: e => this.updateInputValue(e, 'text'),\n      placeholder: \"Abstract\",\n      value: this.state.text,\n      rows: \"10\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 190,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(Form.Group, {\n      controlId: \"formGroupFile\",\n      className: \"my-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(FormControl, {\n      required: true,\n      type: \"file\",\n      onChange: this.captureFile,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"small\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 16\n      }\n    }, \"Submission price: \", this.props.web3.utils.fromWei(this.state.price, 'ether'), \" ETH\")), /*#__PURE__*/React.createElement(Loader, {\n      loaded: !this.state.savingText,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      type: \"submit\",\n      className: \"mt-3 pure-button pure-input-1-2 button-success\",\n      disabled: !this.validForm() || this.state.savingText,\n      onClick: () => this.saveText(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 11\n      }\n    }, \"Submit\"))))))));\n  }\n\n}\n\nexport default SubmitForm;","map":{"version":3,"sources":["/home/fer/UCE/Tesis/blockchain-dapp/client/src/components/SubmitForm.js"],"names":["React","Component","Form","FormControl","Button","Alert","Row","Col","Loader","require","SubmitForm","constructor","props","captureFile","event","stopPropagation","preventDefault","file","target","files","reader","window","FileReader","readAsArrayBuffer","onloadend","convertToBuffer","buffer","Buffer","from","result","setState","state","loadingVersion","loadingPrice","fullName","title","text","price","componentDidMount","match","params","id","loadSubmission","UNSAFE_componentWillMount","loadPrice","hashId","Promise","resolve","reject","submission","hashStoreContractInstance","getPaperByID","then","values","sender","hashContent","timestamp","toNumber","addNotification","catch","err","console","log","toString","saveText","data","savingText","ipfs","add","fileHash","message","addJSON","hash","web3","eth","defaultAccount","saveNewVersion","value","gas","tx","logs","args","_hashId","saveNewPaper","updateInputValue","e","field","validForm","render","utils","fromWei"],"mappings":"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","sourcesContent":["import React, {Component} from 'react'\n\nimport {Form, FormControl, Button, Alert, Row, Col} from 'react-bootstrap';\n\nvar Loader = require('react-loader');\n\n\nclass SubmitForm extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      loadingVersion: false,\n      loadingPrice: false,\n      fullName: '',\n      title: '',\n      text: '',\n      price: ''\n    };\n  }\n\n  componentDidMount() {\n    if (this.props.match.params.id) {\n      this.loadSubmission(this.props.match.params.id);\n    }\n  }\n\n  UNSAFE_componentWillMount() {\n    this.loadPrice();\n  }\n\n  loadSubmission(hashId) {\n    return new Promise((resolve, reject) => {\n      this.setState({loadingVersion: true});\n      let submission = {};\n      this.props.hashStoreContractInstance.getPaperByID(hashId).then((values) => {\n        submission.sender = values[0];\n        submission.hashContent = values[1];\n        submission.timestamp = values[2].toNumber();\n        submission.hashId = hashId;\n        if (submission.timestamp === 0) {\n          this.setState({loadingVersion: false});\n          this.props.addNotification(\"Cannot find the paper\", \"error\");\n          return reject(\"No paper found\")\n        }\n        this.setState({submission: submission});\n        this.setState({loadingVersion: false});\n        resolve(submission);\n      }).catch((err) => {\n        this.setState({loadingVersion: false});\n        return reject(err);\n      });\n    });\n  }\n\n  loadPrice() {\n    console.log(this.props)\n    this.props.hashStoreContractInstance.price().then((result) => { \n      this.setState({price: result.toString()});\n      }\n    )\n  }\n\n  //Take file input from user\n  captureFile =(event) => {\n    event.stopPropagation()\n    event.preventDefault()\n    const file = event.target.files[0]\n    let reader = new window.FileReader()\n    reader.readAsArrayBuffer(file)\n    reader.onloadend = () => this.convertToBuffer(reader)\n  };\n\n  //Convert the file to buffer to store on IPFS \n  convertToBuffer = async(reader) => {\n    //file is converted to a buffer for upload to IPFS\n    const buffer = await Buffer.from(reader.result);\n    //set this buffer-using es6 syntax\n    this.setState({buffer});\n  };\n\n  saveText() {\n    let {fullName, title, text} = this.state;\n    let data = {fullName, title, text};\n    let {buffer} = this.state;\n\n    this.setState({savingText: true});\n\n    this.props.ipfs.add(buffer, (err, fileHash) => {\n      if (err) {\n        this.setState({savingText: false});\n        return this.props.addNotification(err.message, \"error\");\n      }\n      data.file=fileHash;\n      console.log(\"IPFS file hash:\", fileHash);\n\n      \n\n      this.props.ipfs.addJSON(data, (err, hash) => {\n        if (err) {\n          this.setState({savingText: false});\n          return this.props.addNotification(err.message, \"error\");\n        }\n\n        console.log(\"Saved to IPFS\", data);\n        console.log(\"IPFS hash:\", hash);\n        console.log(\"eth address:\", this.props.web3.eth.defaultAccount);\n        console.log(\"eth address:\", this.props.hashStoreContractInstance);\n\n        if(this.props.match.params.id) {\n          this.props.hashStoreContractInstance.saveNewVersion(hash, this.props.match.params.id, {from: this.props.web3.eth.defaultAccount, value: this.state.price, gas: 200000}).then((result) => {\n            /* if(result.receipt.status !== \"0x1\"){ // can be used after byzantium to check status\n              throw new Error(\"Transaction failed\");\n            } */\n  \n            this.setState({savingText: false});\n            console.log('Data saved successfully, Tx:', result.tx);\n            let log = result.logs[0];\n            let hashId = log.args._hashId.toNumber();\n            this.props.addNotification(`New version saved successfully ! Submission ID: ${hashId}`, \"success\");\n            //this.props.onSubmit(hashId);\n          }).catch((err) => {\n            this.setState({savingText: false});\n            this.props.addNotification(err.message, \"error\");\n          });\n\n        } else {\n\n        this.props.hashStoreContractInstance.saveNewPaper(hash, {from: this.props.web3.eth.defaultAccount, value: this.state.price, gas: 200000}).then((result) => {\n          /* if(result.receipt.status !== \"0x1\"){ // can be used after byzantium to check status\n            throw new Error(\"Transaction failed\");\n          } */\n\n          this.setState({savingText: false});\n          console.log('Data saved successfully, Tx:', result.tx);\n          let log = result.logs[0];\n          let hashId = log.args._hashId.toNumber();\n          this.props.addNotification(`Data saved successfully ! Submission ID: ${hashId}`, \"success\");\n          //this.props.onSubmit(hashId);\n        }).catch((err) => {\n          this.setState({savingText: false});\n          this.props.addNotification(err.message, \"error\");\n        });\n      }\n      });\n    });\n  }\n\n  updateInputValue(e, field) {\n    this.setState({[field]: e.target.value});\n  }\n\n  validForm() {\n    if (!this.props.hashStoreContractInstance) {\n      return false;\n    }\n\n    return this.state.fullName && this.state.title && this.state.text && this.state.buffer;\n  }\n\n  render() {\n    return (\n      <div className=\"SubmitForm\">\n        {this.props.match.params.id ? (\n        <h1> Adding new version to {this.props.match.params.id} </h1>    \n            ) : (\n              <h1> Publish a pre-print on Dejournal </h1> \n            )      \n            }\n        <Loader loaded={!this.state.loadingVersion}>\n          {this.props.match.params.id && !this.state.submission ? (\n            <Alert variant=\"danger\">\n            ERROR: Paper with ID {this.props.match.params.id} was not found.\n          </Alert>\n          ) : ( \n          <div>\n\n        <Row>\n          <Col xs={10}>\n        <Form className=\"mt-3\">\n        <Form.Group controlId=\"formGroupTitle\" className=\"mt-3\">\n        <FormControl required type = \"text\" onChange = {e => this.updateInputValue(e, 'title')} \n              placeholder = \"Title\" value={this.state.title}/>\n        </Form.Group>\n        <Form.Group controlId=\"formGroupAuthors\" className=\"mt-4\">\n        <FormControl required type = \"text\" onChange = {e => this.updateInputValue(e, 'fullName')} \n              placeholder = \"Authors\" value={this.state.fullName}/>\n        </Form.Group>\n        <Form.Group controlId=\"formGroupAbstract\" className=\"mt-4\">\n        <FormControl required as = \"textarea\" onChange = {e => this.updateInputValue(e, 'text')} \n              placeholder = \"Abstract\" value={this.state.text} rows=\"10\"/>\n        </Form.Group>\n        <Form.Group controlId=\"formGroupFile\" className=\"my-4\">\n          <FormControl required           \n            type = \"file\"\n            onChange = {this.captureFile}\n          />\n          </Form.Group>\n          \n          <div><small>Submission price: {this.props.web3.utils.fromWei(this.state.price, 'ether')} ETH</small></div>\n          <Loader loaded={!this.state.savingText}>\n          <Button\n            type=\"submit\" className=\"mt-3 pure-button pure-input-1-2 button-success\"\n            disabled={!this.validForm() || this.state.savingText} \n            onClick={() => this.saveText()}>\n              Submit             \n          </Button>\n          </Loader>\n      \n        </Form>\n        </Col>\n        </Row>\n        </div>\n          )\n       }\n        </Loader>\n      </div>\n    );\n  }\n}\n\nexport default SubmitForm;\n"]},"metadata":{},"sourceType":"module"}