{"ast":null,"code":"var _jsxFileName = \"/home/fer/UCE/Tesis/blockchain-dapp/client/src/components/SubmitForm.js\";\nimport React, { Component } from 'react';\nimport { Form, FormControl, Button, Alert, Row, Col } from 'react-bootstrap';\n\nvar Loader = require('react-loader');\n\nclass SubmitForm extends Component {\n  constructor(props) {\n    super(props);\n\n    this.captureFile = event => {\n      event.stopPropagation();\n      event.preventDefault();\n      const file = event.target.files[0];\n      let reader = new window.FileReader();\n      reader.readAsArrayBuffer(file);\n\n      reader.onloadend = () => this.convertToBuffer(reader);\n    };\n\n    this.convertToBuffer = async reader => {\n      //file is converted to a buffer for upload to IPFS\n      const buffer = await Buffer.from(reader.result); //set this buffer-using es6 syntax\n\n      this.setState({\n        buffer\n      });\n    };\n\n    this.state = {\n      cargandoPrecio: false,\n      fullNombre: '',\n      titulo: '',\n      texto: '',\n      precio: ''\n    };\n  }\n\n  componentDidMount() {\n    if (this.props.match.params.id) {\n      this.cargarPaper(this.props.match.params.id);\n    }\n  }\n\n  UNSAFE_componentWillMount() {\n    this.cargarPrecio();\n  }\n\n  cargarPaper(hashId) {\n    return new Promise((resolve, reject) => {\n      let paper = {};\n      this.props.hashStoreContractInstance.getPaperByID(hashId).then(values => {\n        paper.remitente = values[0];\n        paper.hashContenido = values[1];\n        paper.vartiempo = values[2].toNumber();\n        paper.hashId = hashId;\n\n        if (paper.vartiempo === 0) {\n          this.props.addNotification(\"No hay paper\", \"error\");\n          return reject(\"Paper no existe\");\n        }\n\n        this.setState({\n          paper: paper\n        });\n        resolve(paper);\n      }).catch(err => {\n        return reject(err);\n      });\n    });\n  }\n\n  cargarPrecio() {\n    console.log(this.props);\n    this.props.hashStoreContractInstance.precio().then(result => {\n      this.setState({\n        precio: result.toString()\n      });\n    });\n  } //Take file input from user\n\n\n  guardarTexto() {\n    let {\n      fullNombre,\n      titulo,\n      texto\n    } = this.state;\n    let data = {\n      fullNombre,\n      titulo,\n      texto\n    };\n    let {\n      buffer\n    } = this.state;\n    this.setState({\n      guardandoTexto: true\n    });\n    this.props.ipfs.add(buffer, (err, fileHash) => {\n      if (err) {\n        this.setState({\n          guardandoTexto: false\n        });\n        return this.props.addNotification(err.message, \"error\");\n      }\n\n      data.file = fileHash;\n      console.log(\"IPFS hash:\", fileHash);\n      this.props.ipfs.addJSON(data, (err, hash) => {\n        if (err) {\n          this.setState({\n            guardandoTexto: false\n          });\n          return this.props.addNotification(err.message, \"error\");\n        }\n\n        console.log(\"Guardando IPFS\", data);\n        console.log(\"IPFS hash:\", hash);\n        console.log(\"Direccion eth:\", this.props.web3.eth.defaultAccount);\n        console.log(\"Direccion eth:\", this.props.hashStoreContractInstance);\n        this.props.hashStoreContractInstance.guardarNuevoPaper(hash, {\n          from: this.props.web3.eth.defaultAccount,\n          value: this.state.precio,\n          gas: 200000\n        }).then(result => {\n          this.setState({\n            guardandoTexto: false\n          });\n          console.log('Data guardada, Tx:', result.tx);\n          let log = result.logs[0];\n\n          let hashId = log.args._hashId.toNumber();\n\n          this.props.addNotification(`Data guardada ! Paper ID: ${hashId}`, \"success\");\n        }).catch(err => {\n          this.setState({\n            guardandoTexto: false\n          });\n          this.props.addNotification(err.message, \"error\");\n        });\n      });\n    });\n  }\n\n  updateInputValue(e, field) {\n    this.setState({\n      [field]: e.target.value\n    });\n  }\n\n  validForm() {\n    if (!this.props.hashStoreContractInstance) {\n      return false;\n    }\n\n    return this.state.fullNombre && this.state.titulo && this.state.texto && this.state.buffer;\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"SubmitForm\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 7\n      }\n    }, this.props.match.params.id && !this.state.paper ? /*#__PURE__*/React.createElement(Alert, {\n      variant: \"danger\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 11\n      }\n    }, \"ERROR: Paper con ID \", this.props.match.params.id, \" no encontrado.\") : /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Row, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Col, {\n      xs: 10,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Form, {\n      className: \"mt-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Form.Group, {\n      controlId: \"formGroupTitulo\",\n      className: \"mt-3\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(FormControl, {\n      required: true,\n      type: \"text\",\n      onChange: e => this.updateInputValue(e, 'titulo'),\n      placeholder: \"Titulo\",\n      value: this.state.titulo,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(Form.Group, {\n      controlId: \"formGroupAutores\",\n      className: \"mt-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(FormControl, {\n      required: true,\n      type: \"text\",\n      onChange: e => this.updateInputValue(e, 'fullNombre'),\n      placeholder: \"Autores\",\n      value: this.state.fullNombre,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(Form.Group, {\n      controlId: \"formGroupAbstract\",\n      className: \"mt-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(FormControl, {\n      required: true,\n      as: \"textarea\",\n      onChange: e => this.updateInputValue(e, 'texto'),\n      placeholder: \"Abstract\",\n      value: this.state.texto,\n      rows: \"10\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153,\n        columnNumber: 9\n      }\n    })), /*#__PURE__*/React.createElement(Form.Group, {\n      controlId: \"formGroupFile\",\n      className: \"my-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(FormControl, {\n      required: true,\n      type: \"file\",\n      onChange: this.captureFile,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 11\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"small\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 16\n      }\n    }, \"Precio de paper: \", this.props.web3.utils.fromWei(this.state.precio, 'ether'), \" ETH\")), /*#__PURE__*/React.createElement(Loader, {\n      loaded: !this.state.guardandoTexto,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Button, {\n      type: \"submit\",\n      className: \"mt-3 pure-button pure-input-1-2 button-success\",\n      disabled: !this.validForm() || this.state.guardandoTexto,\n      onClick: () => this.guardarTexto(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 11\n      }\n    }, \"Enviar\")))))));\n  }\n\n}\n\nexport default SubmitForm;","map":{"version":3,"sources":["/home/fer/UCE/Tesis/blockchain-dapp/client/src/components/SubmitForm.js"],"names":["React","Component","Form","FormControl","Button","Alert","Row","Col","Loader","require","SubmitForm","constructor","props","captureFile","event","stopPropagation","preventDefault","file","target","files","reader","window","FileReader","readAsArrayBuffer","onloadend","convertToBuffer","buffer","Buffer","from","result","setState","state","cargandoPrecio","fullNombre","titulo","texto","precio","componentDidMount","match","params","id","cargarPaper","UNSAFE_componentWillMount","cargarPrecio","hashId","Promise","resolve","reject","paper","hashStoreContractInstance","getPaperByID","then","values","remitente","hashContenido","vartiempo","toNumber","addNotification","catch","err","console","log","toString","guardarTexto","data","guardandoTexto","ipfs","add","fileHash","message","addJSON","hash","web3","eth","defaultAccount","guardarNuevoPaper","value","gas","tx","logs","args","_hashId","updateInputValue","e","field","validForm","render","utils","fromWei"],"mappings":"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","sourcesContent":["import React, {Component} from 'react'\nimport {Form, FormControl, Button, Alert, Row, Col} from 'react-bootstrap';\n\nvar Loader = require('react-loader');\n\nclass SubmitForm extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      cargandoPrecio: false,\n      fullNombre: '',\n      titulo: '',\n      texto: '',\n      precio: ''\n    };\n  }\n\n  componentDidMount() {\n    if (this.props.match.params.id) {\n      this.cargarPaper(this.props.match.params.id);\n    }\n  }\n\n  UNSAFE_componentWillMount() {\n    this.cargarPrecio();\n  }\n\n  cargarPaper(hashId) {\n    return new Promise((resolve, reject) => {\n      let paper = {};\n      this.props.hashStoreContractInstance.getPaperByID(hashId).then((values) => {\n        paper.remitente = values[0];\n        paper.hashContenido = values[1];\n        paper.vartiempo = values[2].toNumber();\n        paper.hashId = hashId;\n        if (paper.vartiempo === 0) {\n          this.props.addNotification(\"No hay paper\", \"error\");\n          return reject(\"Paper no existe\")\n        }\n        this.setState({paper: paper});\n        resolve(paper);\n      }).catch((err) => {\n        return reject(err);\n      });\n    });\n  }\n\n  cargarPrecio() {\n    console.log(this.props)\n    this.props.hashStoreContractInstance.precio().then((result) => { \n      this.setState({precio: result.toString()});\n      }\n    )\n  }\n\n  //Take file input from user\n  captureFile =(event) => {\n    event.stopPropagation()\n    event.preventDefault()\n    const file = event.target.files[0]\n    let reader = new window.FileReader()\n    reader.readAsArrayBuffer(file)\n    reader.onloadend = () => this.convertToBuffer(reader)\n  };\n\n  //Convert the file to buffer to store on IPFS \n  convertToBuffer = async(reader) => {\n    //file is converted to a buffer for upload to IPFS\n    const buffer = await Buffer.from(reader.result);\n    //set this buffer-using es6 syntax\n    this.setState({buffer});\n  };\n\n  guardarTexto() {\n    let {fullNombre, titulo, texto} = this.state;\n    let data = {fullNombre, titulo, texto};\n    let {buffer} = this.state;\n\n    this.setState({guardandoTexto: true});\n\n    this.props.ipfs.add(buffer, (err, fileHash) => {\n      if (err) {\n        this.setState({guardandoTexto: false});\n        return this.props.addNotification(err.message, \"error\");\n      }\n      data.file=fileHash;\n      console.log(\"IPFS hash:\", fileHash);\n\n      this.props.ipfs.addJSON(data, (err, hash) => {\n        if (err) {\n          this.setState({guardandoTexto: false});\n          return this.props.addNotification(err.message, \"error\");\n        }\n\n        console.log(\"Guardando IPFS\", data);\n        console.log(\"IPFS hash:\", hash);\n        console.log(\"Direccion eth:\", this.props.web3.eth.defaultAccount);\n        console.log(\"Direccion eth:\", this.props.hashStoreContractInstance);\n\n        this.props.hashStoreContractInstance.guardarNuevoPaper(hash, {from: this.props.web3.eth.defaultAccount, value: this.state.precio, gas: 200000}).then((result) => {\n          \n          this.setState({guardandoTexto: false});\n          console.log('Data guardada, Tx:', result.tx);\n          let log = result.logs[0];\n          let hashId = log.args._hashId.toNumber();\n          this.props.addNotification(`Data guardada ! Paper ID: ${hashId}`, \"success\");\n\n        }).catch((err) => {\n          this.setState({guardandoTexto: false});\n          this.props.addNotification(err.message, \"error\");\n        });\n      \n      });\n    });\n  }\n\n  updateInputValue(e, field) {\n    this.setState({[field]: e.target.value});\n  }\n\n  validForm() {\n    if (!this.props.hashStoreContractInstance) {\n      return false;\n    }\n\n    return this.state.fullNombre && this.state.titulo && this.state.texto && this.state.buffer;\n  }\n\n  render() {\n    return (\n      <div className=\"SubmitForm\">\n        \n        {this.props.match.params.id && !this.state.paper ? (\n          <Alert variant=\"danger\">\n          ERROR: Paper con ID {this.props.match.params.id} no encontrado.\n        </Alert>\n        ) : ( \n        <div>\n\n        <Row>\n          <Col xs={10}>\n        <Form className=\"mt-3\">\n        <Form.Group controlId=\"formGroupTitulo\" className=\"mt-3\">\n        <FormControl required type = \"text\" onChange = {e => this.updateInputValue(e, 'titulo')} \n              placeholder = \"Titulo\" value={this.state.titulo}/>\n        </Form.Group>\n        <Form.Group controlId=\"formGroupAutores\" className=\"mt-4\">\n        <FormControl required type = \"text\" onChange = {e => this.updateInputValue(e, 'fullNombre')} \n              placeholder = \"Autores\" value={this.state.fullNombre}/>\n        </Form.Group>\n        <Form.Group controlId=\"formGroupAbstract\" className=\"mt-4\">\n        <FormControl required as = \"textarea\" onChange = {e => this.updateInputValue(e, 'texto')} \n              placeholder = \"Abstract\" value={this.state.texto} rows=\"10\"/>\n        </Form.Group>\n        <Form.Group controlId=\"formGroupFile\" className=\"my-4\">\n          <FormControl required           \n            type = \"file\"\n            onChange = {this.captureFile}\n          />\n          </Form.Group>\n          \n          <div><small>Precio de paper: {this.props.web3.utils.fromWei(this.state.precio, 'ether')} ETH</small></div>\n          <Loader loaded={!this.state.guardandoTexto}>\n          <Button\n            type=\"submit\" className=\"mt-3 pure-button pure-input-1-2 button-success\"\n            disabled={!this.validForm() || this.state.guardandoTexto} \n            onClick={() => this.guardarTexto()}>\n              Enviar             \n          </Button>\n          </Loader>\n      \n        </Form>\n        </Col>\n        </Row>\n        </div>\n          )\n       }\n        \n      </div>\n    );\n  }\n}\n\nexport default SubmitForm;\n"]},"metadata":{},"sourceType":"module"}